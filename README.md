# CookieJar

CookieJar is a collection of smart contracts that allow users to deposit ERC20 and ERC721 tokens and earn interest on their deposits. The contracts are designed to be modular and extensible, allowing developers to easily add new features and functionality.

# Deployment

The following table lists the addresses of the deployed contracts:

| Contract            | Address                                      |
| ------------------- | -------------------------------------------- | 
| ERC20 Cookie Jar    | `0x8e694435C2Ad04ac4C59F50d75D501f678aD26bd` |
| ERC721 Cookie Jar   | `0x24A2D8772521A9fa2f85d7024e020e7821C23c97` |
| List Cookie Jar     | `0x3Ae8da051CC6Ab7Ef884A8f0fF86e02c3303fc38` |
| Open Cookie Jar     | `0x0c6544Af9424C24549c57BD805C299635081eDE4` |
| Cookie Jar Factory  | `0x3737053eC30f53DD7543a615dA69BB9996aD7C81` |
| List Cookie Jar6551 | `0x3Ae8da051CC6Ab7Ef884A8f0fF86e02c3303fc38` |
| Account             | `0x9CD838ba5ce219d1Eaf58Fa413b9D6e74799A7c8` |
| NFT                 | `0xc9997Bf3D85ef279C2671Fccc4E7Fa4ef092450B` |

The contracts are written in Solidity and use the Truffle framework for development and testing. The contracts are also compatible with the OpenZeppelin library, which provides a set of reusable smart contract components.

## Installation

To run the CookieJar contracts, you will need to have foundry installed on your system. You can then run the following command:

`forge compile`

And you should get no errors

## Testing

To run the tests for the Cookie Jar contracts, you can run the following command:

`forge test`

## Jar features

## Poster schema

The Poster contract is used to emit events on chain as a way to store more complex information on chain in a gas-efficient manner.

### Generating IDs

The CookieUtils library provides utility functions for generating unique identifiers (UIDs) for cookies and cookie jars.

#### getCookieJarUid

The getCookieJarUid function is used to generate a unique identifier for a cookie jar. The function takes an address parameter cookieJarAddr and returns a string that represents the unique identifier.

For example, to generate a unique identifier for a new cookie jar, you can call the getCookieJarUid function with the address of the new cookie jar as the input parameter:

```js
    function getCookieJarUid(address cookieJarAddr) internal view returns (string memory) {
        return string(abi.encodePacked(Strings.toHexString(uint160(cookieJarAddr)), Strings.toHexString(block.chainid)));
    }
```

The unique identifier is generated by concatenating the hexadecimal representation of the cookieJarAddr parameter with the hexadecimal representation of the current blockchain chain ID.

#### getCookieUid

The getCookieUid function is used to generate a unique identifier for a cookie. The function takes a string parameter cookieJarUid and returns a string that represents the unique identifier.

Similarly, to generate a unique identifier for a new cookie, you can call the getCookieUid function with the unique identifier of the cookie jar as the input parameter:

```js
   function getCookieUid(string memory cookieJarUid) internal view returns (string memory) {
        return bytes32ToString(keccak256(abi.encodePacked(cookieJarUid, msg.sender, block.timestamp)));
    }
```

The unique identifier is generated by concatenating the cookieJarUid parameter with the hexadecimal representation of the current user's address and the current block timestamp.

### Details schema

#### Post Claim Reason

The post claim reason event is used to store a reason for a claim made by a user. The event has the following schema:

```json
{
  "tag": "CookieJar.<jar_uid>.reason.<cookie_uid>",
  "content": "...reason..."
}
```

- tag: A string that identifies the type of event and the unique identifier of the CookieJar contract and the cookie.
- content: A string that contains the reason for the claim.

#### Assess Reason

The assess reason event is used to store an assessment of a reason for a claim made by a user. The event has the following schema:

```json
{
  "tag": "CookieJar.<jar_uid>.reaction.<cookie_uid>",
  "content": "...reason..."
}
```

- tag: A string that identifies the type of event and the unique identifier of the CookieJar contract and the cookie.
- content: A string that contains the assessment of the reason for the claim.
